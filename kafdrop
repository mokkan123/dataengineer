Incident Report: Kafdrop – Topic Describe Failures after Envoy Crash
1. Environment

Kafka Cluster: 3 nodes, healthy and reachable.

Kafdrop: Kafka Web UI running on a separate server, configured to connect via Envoy.

Envoy: Acts as a proxy layer in front of Kafdrop. Recently experienced a crash.

2. Symptoms

Kafdrop UI

Topic list loads successfully.

Selecting a topic results in timeout.

Failures occur on FindCoordinator API calls (used for consumer groups and offsets).

Logs show: “Kafka node is disconnected.”

Kafka CLI (on the Kafdrop host)

kafka-topics.sh --describe works correctly.

kafka-consumer-groups.sh --describe works correctly.

This confirms CLI tools can communicate with brokers without issue.

tcpdump (on Kafdrop server)

Kafka broker replies are observed.

TCP connection is reset (RST) by the Kafdrop server itself, not by the brokers.

3. Observations

Kafka cluster is healthy; no broker disconnections were observed.

CLI commands work as expected → connectivity, advertised.listeners, and broker configurations are correct.

Failures are isolated to Kafdrop on FindCoordinator calls → this path requires reaching the group coordinator broker, not just the bootstrap broker.

tcpdump evidence shows RST packets originating from the Kafdrop host (client aborts the connection).

4. Likely Root Causes

Stale network state after Envoy crash

Envoy or sidecar components may have left half-open TCP connections.

When Kafdrop attempts to reuse these connections, the OS closes them with RST.

Protocol/Security mismatch on redirected broker connection

CLI may be using client.properties with SASL_SSL, while Kafdrop defaults to PLAINTEXT.

On redirected calls (e.g., FindCoordinator), this mismatch causes Kafdrop to abort the connection.

JVM caching issues

Kafdrop JVM may have cached DNS or connection pool state pointing to unreachable hosts following the Envoy crash.

CLI tools avoid this by resolving fresh on every execution.

5. Next Steps (Verification)

Increase Kafdrop log verbosity to confirm which host/port it is attempting to connect to:

-Dlogging.level.org.apache.kafka=DEBUG
-Djavax.net.debug=ssl,handshake


Test direct reachability of the failing host/port from the Kafdrop server:

nc -vz <host> <port>
openssl s_client -connect <host>:<port> -servername <host>


Review Envoy configuration:

Ensure it is running in L4 passthrough mode.

Confirm that all broker hostnames are resolvable from Kafdrop.

Restart the Kafdrop JVM to clear any stale connection state or DNS caches left after the Envoy crash.

✅ Summary: The Kafka cluster is operating normally. Failures are isolated to Kafdrop, triggered during FindCoordinator calls. Evidence suggests the root cause lies in stale connections or protocol/security mismatches introduced after the Envoy crash. Further validation requires debugging connection details, verifying network reachability, and confirming Envoy’s proxy configuration.

Would you like me to also create a one-page executive “post-mortem style” version (with Impact → Root Cause → Resolution → Action Items) that’s lighter for management audiences?
